<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Migrating from v2 to v3 | DADI Documentation</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" type="text/css" href="http://dadi.tech/assets/css/main.min.css?v=3">
  <link rel="stylesheet" type="text/css" href="/type.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css" />
  <link rel="icon" type="image/png" href="http://dadi.tech/assets/img/favicon.png">
</head>
<body class="docs">
  <header class="alignc pad__top--x2 small cf"><nav><a href="https://dadi.tech/en/" class="inline-block marg__bottom"><img src="https://dadi.tech/assets/img/dadi-light.svg" width="150" height="35" alt="DADI" class="logo"></a><ol><li><a href="https://dadi.tech/en/">Technology</a></li><li><a href="https://dadi.tech/en/on-demand" onclick="ga('send','event','On demand','Click','Docsheader');">On demand</a></li><li><a href="https://dadi.tech/en/support" onclick="ga('send','event','Support','Click','Docsheader');">Support</a></li></ol><ul><li><a href="https://github.com/dadi/" onclick="ga('send','event','Github','Click','Docsheader');">Find us on Github</a></li><li><a href="http://docs.dadi.tech" class="on bg--blue" onclick="ga('send','event','Documentation','Click','Docsheader');">Documentation</a></li></ul></nav><div class="top__bg pattern" style="background-color: #21262d;" data-colors="#21262d,#1d2128,#191d23,#16191e,#121519,#0e1014,#0b0c0f,#07080a,#030405,#000000"></div></header>
    <div class="small">
      <div class="list--breadcrumb titlecase">
        <ul class="container">
        <li><a href="/">Documentation</a></li>
                <li class=""><a href="/web">Web</a></li>
        </ul>
      </div>

      <div class="container">
        <div class="larger hdr">Migrating from v2 to v3</div>
      </div>
    </div>
  </div>
</div>

<main>

    <div class="container normal">
      <div class="grid">
        <div class="col w-3-4 pad__bottom--x2">
          <div class="cf bdr__bottom bdr--bdr-grey pad__bottom small marg__top">
            <div class="inline-block">
              <div class="block fwb">306 words</div>
              <div class="txt--grey">2 min read</div>
            </div>
          </div>

          <div class="documentation">
            <h2 id="1-install-dust-js-dependency">1. Install Dust.js dependency</h2>
<p>Web 3.0 supports multiple template engines. As a consequence, Dust.js is now decoupled from core and needs to be included as a dependency on projects that want to use it.</p>
<pre><code class="lang-coffeescript"><span class="hljs-built_in">npm</span> install <span class="hljs-property">@dadi</span>/web-dustjs --save
</code></pre><h2 id="2-change-bootstrap-script">2. Change bootstrap script</h2>
<p>The bootstrap script (which you may be calling <code class="lang-axapta"><span class="hljs-keyword">index</span>.js</code>, <code class="lang-css"><span class="hljs-tag">main</span><span class="hljs-class">.js</span></code> or <code class="lang-axapta"><span class="hljs-keyword">server</span>.js</code>) now needs to inform Web of the engines it has available and which npm modules implement them.</p>
<pre><code class="lang-javascript"><span class="hljs-built_in">require</span>(<span class="hljs-string">'@dadi/web'</span>)({
  engines: [
    <span class="hljs-built_in">require</span>(<span class="hljs-string">'@dadi/web-dustjs'</span>)
  ]
})
</code></pre>
<h2 id="3-update-config">3. Update config</h2>
<p>The <code>dust</code> config block has been moved inside a generic <code>engines</code> block.</p>
<p><em>Before:</em></p>
<pre><code class="lang-actionscript"><span class="hljs-string">"dust"</span>: {
  <span class="hljs-string">"cache"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-string">"debug"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-string">"debugLevel"</span>: <span class="hljs-string">"DEBUG"</span>,
  <span class="hljs-string">"whitespace"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-string">"paths"</span>: {
    <span class="hljs-string">"helpers"</span>: <span class="hljs-string">"workspace/utils/helpers"</span>
  }
}
</code></pre><p><em>After:</em></p>
<pre><code class="lang-actionscript"><span class="hljs-string">"engines"</span>: {
  <span class="hljs-string">"dust"</span>: {
    <span class="hljs-string">"cache"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-string">"debug"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-string">"debugLevel"</span>: <span class="hljs-string">"DEBUG"</span>,
    <span class="hljs-string">"whitespace"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-string">"paths"</span>: {
      <span class="hljs-string">"helpers"</span>: <span class="hljs-string">"workspace/utils/helpers"</span>
    }
  }
}
</code></pre><h2 id="4-move-partials-directory">4. Move partials directory</h2>
<p>Before Web 3.0, Dust templates were separated between the <code>pages</code> and <code>partials</code> directories, with the former being used for templates that generate a page (i.e. have a route) and the latter being used for partials/includes.</p>
<p>In Web 3.0, all templates live under the same directory (<code>pages</code>). The distinction between a page and a partial is made purely by whether or not the template has an accompanying JSON schema file.</p>
<p>Also, pages and partials can now be located in sub-directories, nested as deeply as possible.</p>
<p>To migrate an existing project, all you need to do is move the <code>partials</code> directory inside <code>pages</code> and everything will work as expected.</p>
<p><em>Before:</em></p>
<pre><code class="lang-1c">workspace
<span class="hljs-string">|_ pages</span>
<span class="hljs-string">|_ partials</span>
</code></pre><p><em>After:</em></p>
<pre><code class="lang-1c">workspace
<span class="hljs-string">|_ pages</span>
  <span class="hljs-string">|_ partials</span>
</code></pre><pre><code class="lang-mel">mv <span class="hljs-keyword">workspace</span>/partials <span class="hljs-keyword">workspace</span>/pages
</code></pre><h2 id="5-update-dust-helpers">5. Update Dust helpers</h2>
<p>If your project is using custom helpers, you might need to change the way they access the Dust engine. You should now access the module directly, rather than reference the one from Web.</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// Before</span>
<span class="hljs-keyword">var</span> dust = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@dadi/web'</span>).Dust
<span class="hljs-built_in">require</span>(<span class="hljs-string">'@dadi/dustjs-helpers'</span>)(dust.getEngine())

<span class="hljs-comment">// After</span>
<span class="hljs-keyword">var</span> dust = <span class="hljs-built_in">require</span>(<span class="hljs-string">'dustjs-linkedin'</span>)
<span class="hljs-built_in">require</span>(<span class="hljs-string">'@dadi/dustjs-helpers'</span>)(dust)
</code></pre>



            <p class="cf bdr__top bdr--bdr-grey pad__top pad__bottom small marg__top--x2">
              See something to improve? <a target="_blank" href="http://github.com/dadi/docs/edit/master/_src/web/getting-started/v3-migration.md">Edit in Github</a>.
            </p>
          </div>
        </div>
         <div class="col w-1-4">
          <div class="pad__top--half stick" stick-spacer="false" stick-parent=".container">
            <ul class="hide list--line small bg--light-grey" style="padding:5px 15px">
                <li>
                  <strong class="txt--grey block">Prev</strong>
                  <a href="/web/concepts/middleware">Middleware</a>
                </li>
                <li>
                  <strong class="txt--grey block">Next</strong>
                  <a href="/web/everyday/preload">Preload</a>
                </li>
            </ul>

            <ul class="list--line pad__top--half">
                <li><a class="" href="#1-install-dust-js-dependency">1. Install Dust.js dependency</a></li>
                <li><a class="" href="#2-change-bootstrap-script">2. Change bootstrap script</a></li>
                <li><a class="" href="#3-update-config">3. Update config</a></li>
                <li><a class="" href="#4-move-partials-directory">4. Move partials directory</a></li>
                <li><a class="" href="#5-update-dust-helpers">5. Update Dust helpers</a></li>
            </ul>
        </div>
      </div>
    </div>
</main>

<div class="footer bg--light-grey bdr__top bdr--bdr-grey pad__top--x2 pad__bottom--x2">
  <footer class="small container"><div class="bdr__bottom bdr--bdr-grey marg__bottom--x2 pad__bottom"><div class="grid feed"><div class="col w-1-2"><p class="normal"><strong>The Feed</strong> provides the latest news and releases from DADI along with a collection of the best industry news, resources and inspiration from around the web, curated by us.</p></div><div class="col w-1-2 normal pad__top"><form action="https://dadi.createsend.com/t/d/s/irhyjh/" method="post"><p class="no-marg-i pad--half txt--grey">Get <strong>The Feed</strong> in your inbox</p><input type="text" name="cm-irhyjh-irhyjh" class="email text" placeholder="Your email address"><button class="btn btn--blue" type="submit">Subscribe</button></form></div></div></div><div class="grid"><div class="col w-1-3 pad__bottom"><ul class="list--line normal txt--blue"><li><a href="https://dadi.tech/en/contact/">Contact us</a></li><li><a href="https://dadi.tech/en/about/">About &amp; Careers</a></li><li><a href="https://dadi.tech/en/support/">Support</a></li><li><a href="https://dadi.tech/en/latest/">Latest</a></li><li><a href="https://dadi.tech/en/on-demand/" onclick="ga('send','event','On demand','Click','Footer');">On demand</a></li><li><a href="https://dadi.tech/en/how-we-work/">How we work</a><li><a href="https://dadi.tech/en/faq/">FAQ</a><li><a href="https://dadi.tech/en/privacy/">Privacy</a></li></ul></div><div class="col w-1-3 pad__bottom"><p class="normal hdr"><a href="https://dadi.tech/en/">Technology</a></p><ul class="list--line"><li><a href="https://dadi.tech/en/api/" class="fwb"><img src="/assets/products/dadi-api.png" class="alignv float--right" width="15">API</a></li><li><a href="https://dadi.tech/en/web/" class="fwb"><img src="https://dadi.tech/assets/products/dadi-web.png" class="alignv float--right" width="19">Web</a></li><li><a href="https://dadi.tech/en/publish/" class="fwb"><img src="https://dadi.tech/assets/products/dadi-publish.png" class="alignv float--right" width="15">Publish</a></li><li><a href="https://dadi.tech/en/cdn/" class="fwb"><img src="https://dadi.tech/assets/products/dadi-cdn.png" class="alignv float--right" width="15">CDN</a></li></ul></div><div class="col w-1-3 pad__bottom"><p class="normal hdr">Learn</p><ul class="list--line"><li><a href="https://dadi.tech/en/concepts/">Concepts</a></li><li><a href="https://dadi.tech/en/security/">Security</a></li><li><a href="https://dadi.tech/en/roadmap/">Roadmap</a></li><li><a href="http://docs.dadi.tech" onclick="ga('send','event','Documentation','Click','Footer');" rel="noopener"><img src="https://dadi.tech/assets/icons/pop-out.svg" class="alignv float--right" width="15">Documentation</a></li></ul></div></div><div class="marg__top--x2 pad__top pad__bottom alignc"><ul class="list--inline block marg__bottom--x2"><li class="fwb">© DADI+ Ltd.</li><li><a href="https://twitter.com/dadi">Follow us on Twitter</a></li><li><a href="https://github.com/dadi" onclick="ga('send','event','Github','Click','Footer');">Find us on Github</a></li><li><a href="https://github.com/dadi/dadi.tech">View the repo for this site</a></li></ul><img src="https://dadi.tech/assets/img/d.svg" class="marg__right--x2 alignv" width="45"></div></footer>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script src="http://dadi.tech/assets/js/pattern.min.js"></script>
<script src="http://dadi.tech/assets/js/main.js?v=2"></script>
<script src="/assets/lunr.js"></script>

<script>
var allPageData
var idx

var debounce = function (fn) {
  var timeout
  return function () {
    var args = Array.prototype.slice.call(arguments),
        ctx = this

    clearTimeout(timeout)
    timeout = setTimeout(function () {
      fn.apply(ctx, args)
    }, 100)
  }
}

$(document).ready(function() {
  $.getJSON('data.json', function (allData) {
    allPageData = allData

    $.getJSON('searchIndex.json', function (data) {
      idx = lunr.Index.load(data)

      $('input').bind('keyup', debounce(function () {
        if ($(this).val()) {
          $("#results").removeClass('hide')
          if ($(this).val() < 2) return
          var query = $(this).val()
          var results = idx.search(query)

          results = results.map(function (result) {
            return allPageData.filter(function (page) { return page.path === result.ref })[0]
          })

          renderResults(results)
        } else {
          $("#results").addClass('hide')
        }
      }))
    })
  })
})

var renderResults = function (results) {
  $("#results").empty()

  if (results.length) {
    console.log(results);

    results.forEach(function(result) {
      $("#results").append('<li><a href="' + result.path + '"><h2 class="txt--blue block medium hdr no-marg-i pad__bottom--half">' + result.title + '</h2><div class="no-marg small">' + $(result.excerpt).text() + '</div><div class="txt--grey small no-marg pad__top--half">' + result.path + '</div></a></li>')
    })
  } else {
    $("#results").append('<li>No results found.</li>');
  }
}

</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42395806-3', 'auto');
  ga('send', 'pageview');
</script>

</body>
</html>